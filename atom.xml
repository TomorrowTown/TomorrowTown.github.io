<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://TomorrowTown.github.io</id>
    <title>tomorrow</title>
    <updated>2020-11-06T07:15:13.025Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://TomorrowTown.github.io"/>
    <link rel="self" href="https://TomorrowTown.github.io/atom.xml"/>
    <subtitle>Remember to look up at the stars and not on your feet.</subtitle>
    <logo>https://TomorrowTown.github.io/images/avatar.png</logo>
    <icon>https://TomorrowTown.github.io/favicon.ico</icon>
    <rights>All rights reserved 2020, tomorrow</rights>
    <entry>
        <title type="html"><![CDATA[goæœåŠ¡å™¨æ€§èƒ½åˆ†æå·¥å…·]]></title>
        <id>https://TomorrowTown.github.io/post/go-fu-wu-qi-xing-neng-fen-xi-gong-ju/</id>
        <link href="https://TomorrowTown.github.io/post/go-fu-wu-qi-xing-neng-fen-xi-gong-ju/">
        </link>
        <updated>2020-11-05T14:32:00.000Z</updated>
        <content type="html"><![CDATA[<h2 id="pprof">pprof</h2>
<ol>
<li>åœ¨éœ€è¦ç›‘æµ‹çš„serveræºç ä¸­çš„mainæˆ–initä¸­å¼•å…¥:</li>
</ol>
<pre><code class="language-go">import _ &quot;net/http/pprof&quot;
</code></pre>
<ol start="2">
<li>å¯åŠ¨httpç›‘å¬ç«¯å£ï¼Œä»¥æ­¤ä½œä¸ºæ€§èƒ½åˆ†ææ•°æ®å±•ç¤ºç½‘é¡µã€‚</li>
</ol>
<pre><code class="language-go">go http.ListenAndServe(&quot;:9999&quot;, nil)
</code></pre>
<p>è¿™æ ·ï¼Œé»˜è®¤è®¿é—®åœ°å€ä¸ºlocalhost:9999ã€‚</p>
<blockquote>
<p>æ— è®ºæ˜¯å¦æ˜¯httpæœåŠ¡, éƒ½å¯ä»¥å¼•å…¥**&quot;net/http/pprof&quot;**ä½œä¸ºæ€§èƒ½åˆ†æçš„å·¥å…·ã€‚</p>
</blockquote>
<h2 id="go-torchå’Œflamegraph">go-torchå’ŒFlameGraph</h2>
<ol>
<li>å®‰è£…go-torchå’ŒFlameGraph</li>
</ol>
<pre><code class="language-shell">go get github.com/uber/go-torch
cd $GOPATH/src/github.com/uber/go-torch
git clone https://github.com/brendangregg/FlameGraph.git
sudo cp ./FlameGraph/flamegraph.pl /usr/local/bin
</code></pre>
<p>NOTE: go getåˆ°çš„é¡¹ç›®é»˜è®¤ä¼šæ”¾åˆ°ç”¨æˆ·ç›®å½•ä¸‹çš„goæ–‡ä»¶å¤¹ï¼Œä»¥æ­¤ä½œä¸ºè¯¥é¡¹ç›®çš„GOPATHã€‚</p>
<blockquote>
<p>å¯èƒ½é‡åˆ°çš„é—®é¢˜:<br>
go get github.com/uber/go-torchæ—¶ï¼Œæœ‰å¯èƒ½å‡ºç°ï¼š</p>
<pre><code class="language-shell">unrecognized import path &quot;golang.org/x/sys/unix&quot;: https fetch: Get . . . . . . i/o timeout
</code></pre>
<p>æ­¤æ—¶éœ€è¦:</p>
<pre><code class="language-shell">mkdir -p $GOPATH/src/golang.org.x
cd $GOPATH/src/golang.org/x
git clone https://github.com/golang/sys.git å³å¯
</code></pre>
</blockquote>
<ol start="2">
<li>å®‰è£…åŒ…ç®¡ç†å·¥å…·<br>
glideç”¨äºç¼–è¯‘ä¸Šè¿°ä¸‹è½½çš„go-torchã€‚</li>
</ol>
<pre><code class="language-shell">go get github.com/Masterminds/glide
cd $GOPATH/src/github.com/uber/go-torch
glide install
</code></pre>
<blockquote>
<p>å¯èƒ½é‡åˆ°çš„é—®é¢˜:<br>
åœ¨glide installæ—¶å¯èƒ½å‡ºç°:<br>
<img src="https://TomorrowTown.github.io/post-images/1604588907765.png" alt="" loading="lazy"><br>
ç›´æ¥æ— è§†å³å¯ã€‚</p>
</blockquote>
<ol start="3">
<li>è¿è¡Œæµ‹è¯•ç”¨ä¾‹</li>
</ol>
<pre><code class="language-shell">...... go-torch]$ go test ./...
</code></pre>
<blockquote>
<p>å¯èƒ½é‡åˆ°çš„é—®é¢˜:<br>
å‡ºç°ä¸€å †ç¼–è¯‘æŠ¥é”™ã€‚ä½†åªè¦ä¸‹åˆ—è¯­å¥éƒ½æ²¡fail, å³å¯æ— è§†å…¶ä»–æŠ¥é”™ï¼š<br>
<img src="https://TomorrowTown.github.io/post-images/1604588991700.png" alt="" loading="lazy"><br>
æœ€åéœ€è¦åˆ°GOPATHçš„binç›®å½•ä¸‹æŸ¥çœ‹æ˜¯å¦ç”Ÿæˆäº†<strong>go-torch</strong>å¯æ‰§è¡Œæ–‡ä»¶, æœ‰åˆ™æˆåŠŸ</p>
</blockquote>
<h2 id="è¿è¡Œgo-torchè·å–ç«ç„°å›¾">è¿è¡Œgo-torchè·å–ç«ç„°å›¾</h2>
<p>åœ¨æˆåŠŸå®Œæˆäº†ä¸Šè¿°æ‰€æœ‰æ­¥éª¤åï¼Œåœ¨ä»»æ„æ–‡ä»¶å¤¹ä¸‹éƒ½å¯è¿è¡Œ go-torchå‘½ä»¤äº†ã€‚<br>
ä¾‹ï¼š</p>
<pre><code class="language-shell">go-torch -u http://localhost:9999 -t 30 -f perf.svg
</code></pre>
<p>ç­‰å¾…30sï¼Œåœ¨è¿è¡Œå‘½ä»¤çš„ç›®å½•ä¸‹å°±ä¼šç”Ÿæˆä¸€ä»½perf.svgï¼ˆé»˜è®¤æ˜¯torch.svgï¼‰æ–‡ä»¶, ç›´æ¥ç½‘é¡µæ‰“å¼€(å®æµ‹chome/Edgeå¯æ­£å¸¸æ‰“å¼€å¹¶å¯ç‚¹å‡»æ–¹å—zoom in)è¯¥æ–‡ä»¶å³å¯çœ‹åˆ°ç«ç„°å›¾ï¼š<br>
<img src="https://TomorrowTown.github.io/post-images/1604589121478.png" alt="" loading="lazy"></p>
<p>æ¥ä¸‹æ¥å°±å¯ä»¥æ„‰å¿«åœ°è¿›è¡Œæ€§èƒ½åˆ†æå•¦ ğŸ˜ƒ<br>
<strong>Tipsï¼š<strong>ç«ç„°å›¾ä¸­ï¼Œçºµè½´ä»ä¸‹åˆ°ä¸Šä»£è¡¨</strong>è°ƒç”¨é¡ºåº</strong>ï¼Œæ¨ªè½´æ¯ä¸ªæ–¹å—çš„é•¿åº¦ä»£è¡¨<strong>å ç”¨CPUçš„æ—¶é•¿ç™¾åˆ†æ¯”</strong>ã€‚</p>
]]></content>
    </entry>
</feed>